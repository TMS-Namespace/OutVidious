@page "/channel/{ChannelId}"
@inherits ChannelPageBase

<PageTitle>@PageTitle</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-4">
    @if (IsInitialLoading)
    {
        <div class="channel-loading">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" Color="Color.Primary" />
            <MudText Typo="Typo.body1" Class="mt-2">Loading channel...</MudText>
        </div>
    }
    else if (!string.IsNullOrWhiteSpace(ErrorMessage))
    {
        <MudAlert Severity="Severity.Error" Class="ma-4">
            @ErrorMessage
        </MudAlert>
    }
    else if (ViewModel is not null)
    {
        <!-- Channel Header -->
        <div class="channel-header">
            @if (BannerUrl is not null)
            {
                <AsyncImageComponent 
                    ImageUrl="@BannerUrl" 
                    Alt="Channel Banner"
                    Class="channel-banner-image"
                    ObjectFit="ObjectFit.Cover"
                    UseAsyncLoading="false" />
            }

            <div class="channel-info">
                <MudAvatar Size="Size.Large" Class="channel-avatar">
                    <AsyncImageComponent 
                        ImageUrl="@AvatarUrl" 
                        Alt="@ViewModel.Channel.Name"
                        ObjectFit="ObjectFit.Cover"
                        UseAsyncLoading="false" />
                </MudAvatar>

                <div class="channel-details">
                    <MudText Typo="Typo.h4" Class="channel-name">
                        @ViewModel.Channel.Name
                    </MudText>

                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        @ViewModel.Channel.SubscriberCountText
                    </MudText>

                    @if (!string.IsNullOrWhiteSpace(ViewModel.Channel.Description))
                    {
                        <MudText Typo="Typo.body2" Class="channel-description mt-2">
                            @ViewModel.Channel.Description
                        </MudText>
                    }
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        @if (ViewModel.Channel.AvailableTabs.Count > 0)
        {
            <MudTabs @bind-ActivePanelIndex="SelectedTabIndex" 
                     Elevation="0" 
                     ApplyEffectsToContainer="true"
                     Class="channel-tabs">
                @foreach (var tab in ViewModel.Channel.AvailableTabs)
                {
                    <MudTabPanel Text="@tab.DisplayName" ID="@tab.TabId" />
                }
            </MudTabs>
        }

        <!-- Videos Grid -->
        <VideosGridComponent 
            Videos="@ViewModel.Videos"
            ShowChannelName="false"
            IsLoading="@ViewModel.IsLoading"
            IsLoadingMore="@ViewModel.IsLoadingMore"
            HasMore="@ViewModel.HasMore"
            OnVideoClick="HandleVideoClick"
            OnLoadMore="HandleLoadMore" />
    }
</MudContainer>
