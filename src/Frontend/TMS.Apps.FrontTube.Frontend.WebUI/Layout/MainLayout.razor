@inherits LayoutComponentBase

@* MudBlazor providers for dialogs, snackbars, etc. - still needed for MudBlazor components *@
<MudThemeProvider
    @bind-IsDarkMode="@_isDarkMode"
    Theme="_theme" />

<MudPopoverProvider />

<MudDialogProvider />

<MudSnackbarProvider />

@* Simple container-based layout for dock panels with theme support *@
<div
    class="fronttube-app @(_isDarkMode ? "dark-theme" : "light-theme")"
    data-bs-theme="@BootstrapTheme">
    @* Header *@
    <header
        class="fronttube-header">
        <span
            class="fronttube-title">
            FrontTube
        </span>

        <div
            class="fronttube-header-actions">
            <a
                href="/settings"
                class="header-btn"
                title="Settings">
                <i
                    class="fa-solid fa-gear"></i>
            </a>

            <button
                class="header-btn"
                title="@(_isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode")"
                @onclick="ToggleDarkMode">
                <i
                    class="@(_isDarkMode ? "fa-solid fa-sun" : "fa-solid fa-moon")"></i>
            </button>
        </div>
    </header>

    @* Main content with dock panels *@
    <main
        class="fronttube-main">
        @* Loading overlay shown while dock panels are initializing *@
        @if (!_isDockPanelsReady)
        {
            <div
                class="fronttube-loading-overlay">
                <MudProgressCircular
                    Color="Color.Primary"
                    Indeterminate="true"
                    Size="Size.Large" />

                <MudText
                    Typo="Typo.body1"
                    Class="mt-4">
                    Loading...
                </MudText>
            </div>
        }

        <DocksHostComponent
            @ref="_dockPanelsComponent"
            Id="FrontTubeDockView"
            Name="FrontTubeDockView"
            class="@GetDockPanelsClass()"
            HiddenClass="fronttube-dockview-hidden"
            EnableLocalStorage="false"
            Theme="@CurrentDockPanelTheme"
            DefaultDrawerWidthPx="500"
            @bind-IsReady="_isDockPanelsReady"
            OnVisibleStateChangedAsync="@OnVisibleStateChangedAsync"
            OnActiveStateChangedAsync="@OnActiveStateChangedAsync">
            
            <DocksCollectionComponent
                Type="DockCollectionType.Row">
                @* Main content area - Video Player - pinned and not closable *@
                
                <DockPanelComponent
                    @ref="_videoPlayerPanel"
                    Title="Video Player"
                    ShowClose="false"
                    ShowTitleBar="true"
                    TitleBarIcon="@VideoPlayerPanelIcon"
                    Width="70">
                    <ChildContent>
                        <div
                            class="main-content-wrapper">
                            @Body
                        </div>
                    </ChildContent>
                </DockPanelComponent>

                @* Right sidebar with grouped tabs organized in a column *@
                <DocksCollectionComponent
                    Type="DockCollectionType.Column"
                    Width="30">
                    @* Group 1: Channel Info and Videos - starts hidden, shown via JS when user clicks channel *@
                    @* Only render after first channel open to prevent recreation when closed *@
                    @if (ShouldRenderChannelGroup)
                    {
                        <DocksCollectionComponent
                            Type="DockCollectionType.Group"
                            StaticGroupIcon="@ChannelGroupIcon"
                            Height="25">
                            <DockPanelComponent
                                @ref="_channelAboutPanel"
                                Title="@ChannelAboutPanelTitle"
                                Visible="@IsPanelVisible(_channelAboutPanel, ShouldRenderChannelGroup)"
                                IsActive="true"
                                StaticGroupTitle="@ChannelGroupTitle"
                                ShowTitleBar="true"
                                TitleBarIcon="@ChannelAboutPanelIcon"
                                ShowClose="true"
                                CloseMode="DockPanelCloseMode.HideDrawerTab"
                                FloatType="DockPanelFloatType.Drawer"
                                Direction="DockPanelDrawerDirection.Right"
                                Drawer="@ChannelDrawerOptions">
                                <ChildContent>
                                    <div
                                        class="dock-panel-content">
                                        @if (IsChannelAboutPanelActive)
                                        {
                                            <ChannelAboutComponent
                                                IsActive="@IsChannelAboutPanelActive"
                                                ChannelId="@ChannelId" />
                                        }
                                    </div>
                                </ChildContent>
                            </DockPanelComponent>

                            <DockPanelComponent
                                @ref="_channelVideosPanel"
                                Title="@ChannelVideosPanelTitle"
                                Visible="@IsPanelVisible(_channelVideosPanel, ShouldRenderChannelGroup)"
                                StaticGroupTitle="@ChannelGroupTitle"
                                ShowTitleBar="true"
                                TitleBarIcon="@ChannelVideosPanelIcon"
                                ShowClose="true"
                                CloseMode="DockPanelCloseMode.HideDrawerTab"
                                FloatType="DockPanelFloatType.Drawer"
                                Direction="DockPanelDrawerDirection.Right"
                                Drawer="@ChannelDrawerOptions">
                                <ChildContent>
                                    <div
                                        class="dock-panel-content">
                                        @if (IsChannelVideosPanelActive)
                                        {
                                            <ChannelVideosComponent
                                                IsActive="@IsChannelVideosPanelActive"
                                                ChannelId="@ChannelId" />
                                        }
                                    </div>
                                </ChildContent>
                            </DockPanelComponent>
                        </DocksCollectionComponent>
                    }

                    @* Group 2: Search - separate group *@
                    <DocksCollectionComponent
                        Type="DockCollectionType.Group"
                        StaticGroupIcon="@SearchGroupIcon"
                        Height="15">
                        <DockPanelComponent
                            @ref="_searchPanel"
                            Title="Search"
                            Visible="@IsPanelVisible(_searchPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            ShowTitleBar="true"
                            TitleBarIcon="@SearchPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudTextField
                                        T="string"
                                        Label="Search videos..."
                                        Variant="Variant.Outlined"
                                        Adornment="Adornment.End"
                                        AdornmentIcon="@Icons.Material.Filled.Search" />
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DocksCollectionComponent>

                    @* Group 3: Queue + Local Playlists + Favorites + History *@
                    <DocksCollectionComponent
                        Type="DockCollectionType.Group"
                        StaticGroupIcon="@CollectionsGroupIcon"
                        Height="20">
                        <DockPanelComponent
                            @ref="_queuePanel"
                            Title="Queue"
                            Visible="@IsPanelVisible(_queuePanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@CollectionsGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@QueuePanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Queue content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_localPlaylistsPanel"
                            Title="Local Playlists"
                            Visible="@IsPanelVisible(_localPlaylistsPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@CollectionsGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@LocalPlaylistsPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Local playlists content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_favoritesPanel"
                            Title="Favorites"
                            Visible="@IsPanelVisible(_favoritesPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@CollectionsGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@FavoritesPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Favorites content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_historyPanel"
                            Title="History"
                            Visible="@IsPanelVisible(_historyPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@CollectionsGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@HistoryPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Watch history content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DocksCollectionComponent>

                    @* Group 4: Trending + Popular *@
                    <DocksCollectionComponent
                        Type="DockCollectionType.Group"
                        StaticGroupIcon="@DiscoverGroupIcon"
                        Height="20">
                        <DockPanelComponent
                            @ref="_trendingPanel"
                            Title="Trending"
                            Visible="@IsPanelVisible(_trendingPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@DiscoverGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@TrendingPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Trending videos content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_popularPanel"
                            Title="Popular"
                            Visible="@IsPanelVisible(_popularPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@DiscoverGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@PopularPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Popular videos content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DocksCollectionComponent>

                    @* Group 5: Video Description + Video Comments + Related Videos *@
                    <DocksCollectionComponent
                        Type="DockCollectionType.Group"
                        StaticGroupIcon="@VideoInfoGroupIcon"
                        Height="20">
                        <DockPanelComponent
                            @ref="_videoDescriptionPanel"
                            Title="Description"
                            Visible="@IsPanelVisible(_videoDescriptionPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@VideoInfoGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@VideoDescriptionPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Video description will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_videoCommentsPanel"
                            Title="Comments"
                            Visible="@IsPanelVisible(_videoCommentsPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@VideoInfoGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@VideoCommentsPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Video comments will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            @ref="_relatedVideosPanel"
                            Title="Related Videos"
                            Visible="@IsPanelVisible(_relatedVideosPanel)"
                            Drawer="@SidebarDrawerOptions"
                            FloatType="DockPanelFloatType.Drawer"
                            StaticGroupTitle="@VideoInfoGroupTitle"
                            ShowTitleBar="true"
                            TitleBarIcon="@RelatedVideosPanelIcon"
                            ShowClose="true">
                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Related videos will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DocksCollectionComponent>
                </DocksCollectionComponent>
            </DocksCollectionComponent>
        </DocksHostComponent>
    </main>
</div>

<div
    id="blazor-error-ui">
    An unhandled error has occurred.
    <a
        href=""
        class="reload">Reload</a>
    <a
        class="dismiss">ðŸ—™</a>
</div>
