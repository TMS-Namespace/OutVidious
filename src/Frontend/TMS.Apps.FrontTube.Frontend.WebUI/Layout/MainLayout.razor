@inherits LayoutComponentBase

@* MudBlazor providers for dialogs, snackbars, etc. - still needed for MudBlazor components *@
<MudThemeProvider
    @bind-IsDarkMode="@_isDarkMode"
    Theme="_theme" />

<MudPopoverProvider />

<MudDialogProvider />

<MudSnackbarProvider />

@* Simple container-based layout for dock panels with theme support *@
<div
    class="fronttube-app @(_isDarkMode ? "dark-theme" : "light-theme")"
    data-bs-theme="@BootstrapTheme">
    @* Header *@
    <header
        class="fronttube-header">
        <span
            class="fronttube-title">
            FrontTube
        </span>

        <div
            class="fronttube-header-actions">
            <a
                href="/settings"
                class="header-btn"
                title="Settings">
                <i
                    class="fa-solid fa-gear"></i>
            </a>

            <button
                class="header-btn"
                title="@(_isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode")"
                @onclick="ToggleDarkMode">
                <i
                    class="@(_isDarkMode ? "fa-solid fa-sun" : "fa-solid fa-moon")"></i>
            </button>
        </div>
    </header>

    @* Main content with dock panels *@
    <main
        class="fronttube-main">
        @* Loading overlay shown while dock panels are initializing *@
        @if (!_isDockPanelsReady)
        {
            <div
                class="fronttube-loading-overlay">
                <MudProgressCircular
                    Color="Color.Primary"
                    Indeterminate="true"
                    Size="Size.Large" />

                <MudText
                    Typo="Typo.body1"
                    Class="mt-4">
                    Loading...
                </MudText>
            </div>
        }

        <DockPanelsComponent
            @ref="_dockPanelsComponent"
            Id="FrontTubeDockView"
            Name="FrontTubeDockView"
            class="@GetDockPanelsClass()"
            HiddenClass="fronttube-dockview-hidden"
            EnableLocalStorage="false"
            Theme="@CurrentDockPanelTheme"
            GroupConfigurations="@_groupConfigurations"
            DefaultDrawerWidthPx="500"
            @bind-IsReady="_isDockPanelsReady"
            OnVisibleStateChangedAsync="@OnVisibleStateChangedAsync"
            OnActiveStateChangedAsync="@OnActiveStateChangedAsync">
            <DockPanelContentComponent
                Type="DockPanelContentType.Row">
                @* Main content area - Video Player - pinned and not closable *@
                <DockPanelComponent
                    Key="videoPlayer"
                    Title="Video Player"
                    ShowClose="false"
                    Width="70">
                    <TitleTemplate>
                        <i
                            class="fa-solid fa-play"></i>
                        <span>Video Player</span>
                    </TitleTemplate>

                    <ChildContent>
                        <div
                            class="main-content-wrapper">
                            @Body
                        </div>
                    </ChildContent>
                </DockPanelComponent>

                @* Right sidebar with grouped tabs organized in a column *@
                <DockPanelContentComponent
                    Type="DockPanelContentType.Column"
                    Width="30">
                    @* Group 1: Channel Info and Videos - starts hidden, shown via JS when user clicks channel *@
                    @* Only render after first channel open to prevent recreation when closed *@
                    @if (ShouldRenderChannelGroup)
                    {
                        <DockPanelContentComponent
                            Type="DockPanelContentType.Group"
                            Height="25">
                            <DockPanelComponent
                                @key="_channelAboutRenderVersion"
                                GroupId="@ChannelDrawerGroupId"
                                Key="@ChannelAboutPanelKey"
                                Title="@ChannelAboutPanelTitle"
                                Visible="@IsChannelAboutPanelVisible"
                                IsActive="true"
                                ShowClose="true"
                                CloseMode="DockPanelCloseMode.HideDrawerTab"
                                FloatType="DockPanelFloatType.Drawer"
                                Direction="DockPanelDrawerDirection.Right"
                                Drawer="@ChannelDrawerOptions">
                                <TitleTemplate>
                                    <i
                                        class="fa-solid fa-info-circle"></i>
                                    <span> About</span>
                                </TitleTemplate>

                                <ChildContent>
                                    <div
                                        class="dock-panel-content">
                                        @if (IsChannelAboutPanelActive)
                                        {
                                            <ChannelAboutComponent
                                                IsActive="@IsChannelAboutPanelActive"
                                                ChannelId="@ChannelId" />
                                        }
                                    </div>
                                </ChildContent>
                            </DockPanelComponent>

                            <DockPanelComponent
                                GroupId="@ChannelDrawerGroupId"
                                Key="@ChannelVideosPanelKey"
                                Title="@ChannelVideosPanelTitle"
                                Visible="@IsChannelVideosPanelVisible"
                                ShowClose="true"
                                CloseMode="DockPanelCloseMode.HideDrawerTab"
                                FloatType="DockPanelFloatType.Drawer"
                                Direction="DockPanelDrawerDirection.Right"
                                Drawer="@ChannelDrawerOptions">
                                <TitleTemplate>
                                    <i
                                        class="fa-solid fa-video"></i>
                                    <span> Videos</span>
                                </TitleTemplate>

                                <ChildContent>
                                    <div
                                        class="dock-panel-content">
                                        @if (IsChannelVideosPanelActive)
                                        {
                                            <ChannelVideosComponent
                                                IsActive="@IsChannelVideosPanelActive"
                                                ChannelId="@ChannelId" />
                                        }
                                    </div>
                                </ChildContent>
                            </DockPanelComponent>
                        </DockPanelContentComponent>
                    }

                    @* Group 2: Search - separate group *@
                    <DockPanelContentComponent
                        Type="DockPanelContentType.Group"
                        Height="15">
                        <DockPanelComponent
                            Key="search"
                            Title="Search"
                            Visible="@IsPanelVisible("Search")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-magnifying-glass"></i>
                                <span>Search</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudTextField
                                        T="string"
                                        Label="Search videos..."
                                        Variant="Variant.Outlined"
                                        Adornment="Adornment.End"
                                        AdornmentIcon="@Icons.Material.Filled.Search" />
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DockPanelContentComponent>

                    @* Group 3: Queue + Local Playlists + Favorites + History *@
                    <DockPanelContentComponent
                        Type="DockPanelContentType.Group"
                        Height="20">
                        <DockPanelComponent
                            Key="queue"
                            Title="Queue"
                            Visible="@IsPanelVisible("Queue")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-list-ol"></i>
                                <span>Queue</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Queue content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="localPlaylists"
                            Title="Local Playlists"
                            Visible="@IsPanelVisible("Local Playlists")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-folder"></i>
                                <span>Local Playlists</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Local playlists content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="favorites"
                            Title="Favorites"
                            Visible="@IsPanelVisible("Favorites")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-heart"></i>
                                <span>Favorites</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Favorites content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="history"
                            Title="History"
                            Visible="@IsPanelVisible("History")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-clock-rotate-left"></i>
                                <span>History</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Watch history content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DockPanelContentComponent>

                    @* Group 4: Trending + Popular *@
                    <DockPanelContentComponent
                        Type="DockPanelContentType.Group"
                        Height="20">
                        <DockPanelComponent
                            Key="trending"
                            Title="Trending"
                            Visible="@IsPanelVisible("Trending")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-fire"></i>
                                <span>Trending</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Trending videos content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="popular"
                            Title="Popular"
                            Visible="@IsPanelVisible("Popular")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-chart-line"></i>
                                <span>Popular</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Popular videos content will be added here.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DockPanelContentComponent>

                    @* Group 5: Video Description + Video Comments + Related Videos *@
                    <DockPanelContentComponent
                        Type="DockPanelContentType.Group"
                        Height="20">
                        <DockPanelComponent
                            Key="videoDescription"
                            Title="Description"
                            Visible="@IsPanelVisible("Description")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-file-lines"></i>
                                <span>Description</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Video description will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="videoComments"
                            Title="Comments"
                            Visible="@IsPanelVisible("Comments")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-comments"></i>
                                <span>Comments</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Video comments will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>

                        <DockPanelComponent
                            Key="relatedVideos"
                            Title="Related Videos"
                            Visible="@IsPanelVisible("Related Videos")"
                            ShowClose="true">
                            <TitleTemplate>
                                <i
                                    class="fa-solid fa-video"></i>
                                <span>Related Videos</span>
                            </TitleTemplate>

                            <ChildContent>
                                <div
                                    class="dock-panel-content">
                                    <MudText
                                        Typo="Typo.body1">
                                        Related videos will be shown here when a video is playing.
                                    </MudText>
                                </div>
                            </ChildContent>
                        </DockPanelComponent>
                    </DockPanelContentComponent>
                </DockPanelContentComponent>
            </DockPanelContentComponent>
        </DockPanelsComponent>
    </main>
</div>

<div
    id="blazor-error-ui">
    An unhandled error has occurred.
    <a
        href=""
        class="reload">Reload</a>
    <a
        class="dismiss">ðŸ—™</a>
</div>
